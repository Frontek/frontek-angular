<div class="filters-head">
  <div [ngStyle]="filtersBox" class="filters-box">
    <label *ngFor="let filter of filter.filters; let i = index"
      class="label"
      (click)="onFilterChange($event,filter.value)"
      [ngStyle]="activeFilterValue === filter.value ? activeFilter : null">
      {{ filter.label }}
    </label>
  </div>
  <div class="search-box">
    <label class="search-label" for="search"><span [ngStyle]="searchIcon" class="material-symbols-outlined">search</span></label>
    <input [(ngModel)]="searchTerm" (ngModelChange)="findData()" [ngStyle]="input" id="search" class="search-input" type="text" placeholder="Buscar..." />
  </div>
</div>

<div class="container" [ngStyle]="tbodyStyle">
  <div class="container-body">
    <table [ngStyle]="tableStyle">
      <thead class="thead">
        <tr cdkDropList cdkDropListOrientation="horizontal" (cdkDropListDropped)="onColumnDrop($event)">
          <th class="fixed-width" [ngStyle]="theadStyle"></th>
          <th *ngFor="let header of headers; let i = index" cdkDrag (cdkDragStarted)="onColumnDragStart()" [style.width.px]="headersWidths[i]" [ngStyle]="theadStyle" (mouseenter)="onHeaderHover($event, i, true)" (mouseleave)="onHeaderHover($event, i, false)">
            <div class="space-between">
              <span>{{ header.header }}</span>
              <div class="d-flex">
                  <span (mousedown)="onColumnResizeStart($event, i); $event.stopPropagation();" class="material-symbols-outlined cursor-resize">drag_indicator</span>
              </div>
            </div>
          </th>
          <th [ngStyle]="theadStyle"></th>
        </tr>
      </thead>

      <tbody>
          <div class="trash-columns"><span class="material-symbols-outlined">restore_from_trash</span></div>
        <ng-container *ngFor="let data of filteredData; let i = index">
          <!-- Primary Row -->
          <tr [ngStyle]="trWithDropStyle" (mouseenter)="onTrHover($event, i, true)" (mouseleave)="onTrHover($event, i, false)" [class.removeBorderBottom]="expandedRows.has(i)">
            <td>
              <div (click)="toggleRowExpansion(i)" class="dropdown-handle-box" [ngClass]="{ closed: !expandedRows.has(i), opened: expandedRows.has(i) }">
                <span class="material-symbols-outlined">chevron_right</span>
              </div>
            </td>

            <td *ngFor="let header of headers; let i = index" [style.width.px]="headersWidths[i]" [attr.data-id]="i" class="td-content">
              <ng-container *ngFor="let dataObj of data">
                <td-content *ngIf="header['field'] == dataObj['field']" [data]="dataObj['content']"></td-content>
              </ng-container>
            </td>
            <td class="no-border"></td>
          </tr>

          <tr data-id="{{i}}" class="expandable-row"[class.opened]="expandedRows.has(i)" [ngStyle]="trWithDropStyle">
            <td
              class="expanded-cell " [attr.colspan]="headers.length + 2" >
              <div class="subtable-wrapper" [class.expanded]="expandedRows.has(i)" >
                <table>
                  <thead>
                    <tr>
                      <th
                        *ngFor="let column of subColumnDefinitions; let i = index" [ngStyle]="subtheadStyle" [style.width.px]="subHeadersWidths[i]" (mouseenter)="onHeaderHover($event, i, true)" (mouseleave)="onHeaderHover($event, i, false)">
                         <div class="space-between">
                          <span>{{ column.header }}</span>
                          <div class="d-flex">
                            <span (mousedown)="onSubColumnResizeStart($event, i); $event.stopPropagation();" class="material-symbols-outlined resize">drag_indicator</span>
                          </div>
                        </div>
                      </th>
                      <th [ngStyle]="theadStyle"></th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr class="subtable-row" data-id="{{i}}" [ngStyle]="subtbodyStyle" (mouseenter)="onTrHover($event, i, true)" (mouseleave)="onTrHover($event, i, false)">
                      <td *ngFor="let subcolumn of subColumnDefinitions; let i = index" [style.width.px]="subHeadersWidths[i]" > </td>
                      <td class="no-border"></td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </td>
          </tr>
        </ng-container>
      </tbody>
    </table>
  </div>
</div>
